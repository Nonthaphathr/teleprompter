<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teleprompter Screen</title>
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrious@4.0.2/dist/qrious.min.js"></script>
    <style>
        body {
            background-color: #000;
            color: #fff;
            font-family: Arial, sans-serif;
            margin: 0;
            overflow: hidden; /* ‡∏ã‡πà‡∏≠‡∏ô Scrollbar ‡∏õ‡∏Å‡∏ï‡∏¥ */
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        #setup-area {
            text-align: center;
            padding: 20px;
            background: #222;
            z-index: 1000;
        }
        #qr-container {
            margin-top: 10px;
            background: white;
            padding: 10px;
            display: inline-block;
        }
        #prompter-container {
            flex-grow: 1;
            position: relative;
            overflow: hidden;
            font-size: 50px; /* ‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô */
            line-height: 1.5;
            padding: 50px;
            box-sizing: border-box;
        }
        #scrolling-text {
            position: absolute;
            top: 100%; /* ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡πâ‡∏≤‡∏á‡∏•‡πà‡∏≤‡∏á */
            left: 50px;
            right: 50px;
            transition: transform 0.1s linear; /* ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß */
        }
        /* ‡πÄ‡∏™‡πâ‡∏ô‡∏ô‡∏≥‡∏™‡∏≤‡∏¢‡∏ï‡∏≤ */
        .guide-line {
            position: absolute;
            top: 40%;
            left: 0;
            width: 100%;
            height: 2px;
            background: red;
            opacity: 0.3;
            z-index: 10;
            pointer-events: none;
        }
        /* ‡∏Å‡∏•‡∏±‡∏ö‡∏î‡πâ‡∏≤‡∏ô‡∏Å‡∏£‡∏∞‡∏à‡∏Å */
        .mirror {
            transform: scaleX(-1);
        }
    </style>
</head>
<body>

    <div id="setup-area">
        <h2>üì∑ ‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏µ‡πÇ‡∏°‡∏ó</h2>
        <div id="qr-container">
            <canvas id="qr-code"></canvas>
        </div>
        <p>‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏•‡∏¥‡∏á‡∏Å‡πå: <span id="remote-link" style="color: #4CAF50;"></span></p>
        <p id="status" style="color: yellow;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Server...</p>
    </div>

    <div class="guide-line"></div>

    <div id="prompter-container">
        <div id="scrolling-text" contenteditable="true">
            ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö...<br>
            ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏£‡∏∞‡∏ö‡∏ö Web Teleprompter<br>
            ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏≠‡∏á!<br><br>
            ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢<br>
            ‡πÅ‡∏Ñ‡πà‡∏Ñ‡∏•‡∏¥‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå...<br><br>
            ‡∏•‡∏≠‡∏á‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° Play ‡∏ó‡∏µ‡πà‡∏£‡∏µ‡πÇ‡∏°‡∏ó‡∏î‡∏π‡∏™‡∏¥‡∏Ñ‡∏£‡∏±‡∏ö<br>
            ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏∞‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢‡πÜ<br>
            ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏ô‡∏∏‡∏Å‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö!
        </div>
    </div>

    <script>
        // --- ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ ---
        const BACKEND_URL = "https://teleprompter-09ku.onrender.com"; // URL ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
        const socket = io(BACKEND_URL);

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏° 4 ‡∏ï‡∏±‡∏ß
        const sessionId = Math.random().toString(36).substring(2, 6).toUpperCase();
        
        // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô
        let isScrolling = false;
        let scrollSpeed = 2; // ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        let currentPosition = 0;
        let animationFrameId;

        const textElement = document.getElementById('scrolling-text');
        const statusElement = document.getElementById('status');

        // 1. ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Socket
        socket.on('connect', () => {
            statusElement.innerText = "‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Server ‡πÅ‡∏•‡πâ‡∏ß | Room ID: " + sessionId;
            socket.emit('join-session', sessionId);

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á Link ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏µ‡πÇ‡∏°‡∏ó (‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÑ‡∏ü‡∏•‡πå remote.html ‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô)
            // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: window.location.href ‡∏à‡∏∞‡∏î‡∏∂‡∏á URL ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏°‡∏≤‡∏ï‡∏±‡∏î‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏≠‡∏≠‡∏Å
            const currentPath = window.location.href.substring(0, window.location.href.lastIndexOf('/'));
            const remoteUrl = `${currentPath}/remote.html?session=${sessionId}`;
            
            document.getElementById('remote-link').innerText = remoteUrl;

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code
            new QRious({
                element: document.getElementById('qr-code'),
                value: remoteUrl,
                size: 150
            });
        });

        // 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
        function scroll() {
            if (!isScrolling) return;
            currentPosition -= scrollSpeed;
            textElement.style.top = currentPosition + 'px';
            animationFrameId = requestAnimationFrame(scroll);
        }

        // 3. ‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏µ‡πÇ‡∏°‡∏ó
        socket.on('receive-command', (data) => {
            console.log("Command:", data);
            
            if (data.command === 'toggle') {
                isScrolling = !isScrolling;
                if (isScrolling) {
                    // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà ‡πÉ‡∏´‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°
                    if (currentPosition === 0) currentPosition = document.getElementById('prompter-container').offsetHeight;
                    scroll();
                } else {
                    cancelAnimationFrame(animationFrameId);
                }
            } 
            else if (data.command === 'speed') {
                // ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß (data.value ‡∏Ñ‡∏∑‡∏≠ -1 ‡∏´‡∏£‡∏∑‡∏≠ +1)
                scrollSpeed += data.value;
                if (scrollSpeed < 0) scrollSpeed = 0; // ‡∏´‡πâ‡∏≤‡∏°‡∏ï‡∏¥‡∏î‡∏•‡∏ö
            }
            else if (data.command === 'reset') {
                isScrolling = false;
                cancelAnimationFrame(animationFrameId);
                currentPosition = document.getElementById('prompter-container').offsetHeight; // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÑ‡∏õ‡∏Ç‡πâ‡∏≤‡∏á‡∏•‡πà‡∏≤‡∏á
                textElement.style.top = '100%';
            }
            else if (data.command === 'mirror') {
                document.getElementById('prompter-container').classList.toggle('mirror');
            }
            else if (data.command === 'font-size') {
                let currentSize = parseInt(window.getComputedStyle(document.getElementById('prompter-container')).fontSize);
                document.getElementById('prompter-container').style.fontSize = (currentSize + (data.value * 5)) + 'px';
            }
        });

    </script>
</body>
</html>
